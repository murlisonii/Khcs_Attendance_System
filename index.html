<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Att Face — Browser face detection</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <script src="config.js"></script>
  <script defer src="face-api.min.js"></script>
  <script defer src="script.js"></script>
</head>
<body>
  <div id="app-content">
  <header class="site-header">
    <div class="logo-wrap">
      <img src="assets/logo.svg" alt="Krishna Health Care logo" class="logo">
      <div class="site-title">
        <h1>Krishna Health Care Services</h1>
        <p class="tagline">Caretaker attendance — automated face recognition</p>
      </div>
    </div>
    <div class="brand-actions">
      <div class="header-meta">
        <div class="facility"></div>
        <div id="current-date" class="current-date"></div>
      </div>
      <div class="header-controls">
        <div id="header-admin" class="header-admin" aria-live="polite">
          <span id="header-admin-avatar" class="header-avatar" aria-hidden="true"></span>
          <span id="header-admin-text" class="header-admin-text"></span>
        </div>
        <button id="open-admin-panel" class="btn" title="Open admin panel">Admin</button>
        <span id="status" class="status">Loading models…</span>
      </div>
    </div>
  </header>

  <main class="main">
    <div class="video-panel">
      <div class="video-container">
        <video id="video" width="600" height="450" autoplay muted playsinline></video>
      </div>

      <div class="controls card">
        <p>Allow camera access when prompted. This demo loads labelled faces from <code>./labels</code> and models from <code>/models</code>.</p>
        <ul>
          <li>Sample labels: <strong>moksh</strong>, <strong>shashtika</strong></li>
          <li>Detection runs continuously and draws boxes on the video.</li>
        </ul>

        <div class="control-actions">
          <button id="start-att-btn" class="btn btn-primary" disabled>Start Attendance</button>
          <button id="stop-att-btn" class="btn" disabled>End Attendance</button>
        </div>
        <div class="session-actions" style="margin-top:12px;display:flex;flex-direction:column;gap:8px">
          <label for="session-name" style="font-size:0.85rem;color:var(--muted)">Session name (e.g. Morning shift)</label>
          <input id="session-name" class="session-input" placeholder="Session name (optional)" />
          <div style="display:flex;gap:8px">
            <input id="manual-name-input" class="session-input" placeholder="Add name manually" />
            <button id="manual-add-btn" class="btn">Add</button>
            <button id="clear-session-btn" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.06)">Clear Session</button>
          </div>
        </div>

        <!-- Admin panel moved to the Admin drawer -->
      </div>

      <aside class="attendance-log card" aria-live="polite">
        <div class="log-header">
          <h3>Attendance Log</h3>
          <div class="log-meta"><span id="att-count">0</span> present</div>
        </div>
        <ol id="att-list" class="att-list">
          <!-- logged names will appear here -->
        </ol>
        <div class="log-actions">
          <button id="export-att-btn" class="btn btn-secondary" disabled>Export CSV</button>
          <button id="save-session-btn" class="btn btn-primary" style="margin-left:8px">Save Session</button>
        </div>
      </aside>
    </div>
  </main>

  <!-- Admin slide-over panel -->
  <!-- Admin auth modal (popup) -->
  <div id="admin-modal" class="admin-modal" aria-hidden="true">
    <div class="admin-modal-card">
      <button id="admin-modal-close" class="modal-close" aria-label="Close">✕</button>
      <div class="admin-modal-header">
        <h2>Admin sign in</h2>
        <div class="admin-modal-tabs">
          <button id="tab-login" class="tab-btn active">Login</button>
          <button id="tab-signup" class="tab-btn">Sign up</button>
        </div>
      </div>
      <div class="admin-modal-body card">
        <form id="auth-login-form" class="admin-modal-form">
          <label>Email<div class="field-row"><input id="modal-login-email" type="email" class="session-input" autocomplete="username" /></div></label>
          <label>Password<div class="field-row"><input id="modal-login-password" type="password" class="session-input" autocomplete="current-password" /></div></label>
          <div style="display:flex;align-items:center;gap:12px;margin-top:8px">
            <label style="font-size:0.9rem"><input id="modal-login-remember" type="checkbox" /> Remember me</label>
            <div style="margin-left:auto;display:flex;gap:8px">
              <button id="modal-login-btn" type="button" class="btn btn-primary">Log in</button>
            </div>
          </div>
        </form>

        <form id="auth-signup-form" class="admin-modal-form" hidden style="margin-top:10px">
          <label>Name<div class="field-row"><input id="modal-signup-name" class="session-input" type="text" autocomplete="name" /></div></label>
          <label>Location<div class="field-row"><input id="modal-signup-location" class="session-input" type="text" /></div></label>
          <label>Avatar URL<div class="field-row"><input id="modal-signup-avatar" class="session-input" type="url" placeholder="https://... (optional)" /></div></label>
          <label>Email<div class="field-row"><input id="modal-signup-email" class="session-input" type="email" autocomplete="email" /></div></label>
          <label>Password<div class="field-row"><input id="modal-signup-password" class="session-input" type="password" autocomplete="new-password" /></div></label>
          <label>Confirm Password<div class="field-row"><input id="modal-signup-password-confirm" class="session-input" type="password" autocomplete="new-password" /></div></label>
          <div style="display:flex;justify-content:flex-end;margin-top:8px"><button id="modal-signup-btn" type="button" class="btn btn-primary">Create account</button></div>
        </form>

        <div style="margin-top:10px;display:flex;justify-content:space-between;align-items:center">
          <div id="modal-auth-status" class="modal-status">Not signed in</div>
          <div>
            <button id="modal-open-dashboard" class="btn" style="display:none">Open dashboard</button>
            <button id="modal-logout-btn" class="btn" style="margin-left:8px;display:none">Logout</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="admin-modal-backdrop" class="admin-modal-backdrop" hidden></div>
  <!-- Admin dashboard modal (manage caretakers) -->
  <div id="admin-dashboard-modal" class="admin-modal" aria-hidden="true">
    <div class="admin-modal-card">
      <button id="admin-dashboard-close" class="modal-close" aria-label="Close">✕</button>
      <div class="admin-modal-header">
        <h2>Admin Dashboard</h2>
      </div>
      <div class="admin-modal-body card">
        <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
          <input id="dash-new-name" class="session-input" placeholder="Caretaker name" />
          <input id="dash-new-avatar" class="session-input" placeholder="Avatar URL (optional)" />
          <button id="dash-add-btn" class="btn btn-primary">Add</button>
        </div>
        <div style="margin-top:8px">
          <h4 style="margin:0 0 8px 0">Roster</h4>
          <ul id="dashboard-roster-list" class="roster-list"></ul>
        </div>
      </div>
    </div>
  </div>
  <div id="admin-dashboard-backdrop" class="admin-modal-backdrop" hidden></div>
  <div id="admin-drawer" class="admin-drawer" aria-hidden="true">
    <div class="admin-drawer-header">
      <h3>Admin dashboard</h3>
      <button id="admin-drawer-close" class="btn">Close</button>
    </div>
    <div class="admin-drawer-body">
      <div class="admin-drawer-section card" style="padding:12px">
        <h4 style="margin:0 0 8px 0">Admin sign up / login</h4>
        <div style="display:flex;gap:8px;margin-bottom:8px">
          <input id="admin-name" class="session-input" placeholder="Your name" />
          <input id="admin-location" class="session-input" placeholder="Location" />
          <input id="admin-avatar" class="session-input" placeholder="Avatar URL (optional)" />
        </div>
        <div style="display:flex;gap:8px;margin-bottom:8px">
          <input id="admin-email" class="session-input" placeholder="Email" />
          <input id="admin-password" type="password" class="session-input" placeholder="Password" />
        </div>
        <div style="display:flex;gap:8px">
          <button id="admin-signup-btn" class="btn">Sign up</button>
          <button id="admin-login-btn" class="btn btn-primary">Login</button>
          <button id="admin-logout-btn" class="btn" style="margin-left:auto;display:none">Logout</button>
        </div>
        <div id="admin-status" style="color:var(--muted);font-size:0.9rem;margin-top:8px">Not logged in</div>
      </div>

      <div class="admin-drawer-section card" style="padding:12px">
        <h4 style="margin:0 0 8px 0">Add Caretaker</h4>
        <div style="display:flex;gap:8px;margin-bottom:8px">
          <input id="new-caretaker-name" class="session-input" placeholder="Caretaker name" />
          <input id="new-caretaker-avatar" class="session-input" placeholder="Avatar URL (optional)" />
          <button id="add-caretaker-btn" class="btn btn-primary">Add Caretaker</button>
        </div>
      </div>
      <div class="admin-drawer-section">
        <div class="admin-drawer-actions">
          <button id="roster-refresh-btn" class="btn">Refresh roster</button>
          <button id="roster-export-btn" class="btn">Export roster</button>
        </div>
        <div class="admin-drawer-status">Status: <span id="drawer-admin-status">Not logged in</span></div>
      </div>

      <div class="admin-drawer-section">
        <h4>Roster</h4>
        <ul id="roster-list" class="roster-list">
          <!-- roster items populated by JS -->
        </ul>
      </div>
      <div style="flex:1"></div>
    </div>
  </div>
  <div id="admin-drawer-backdrop" class="admin-drawer-backdrop" hidden></div>

  <footer class="site-footer">
    <small>Made with <strong>face-api.js</strong> • Models served from <code>/models</code></small>
  </footer>
  </div>

  

</body>
</html>
