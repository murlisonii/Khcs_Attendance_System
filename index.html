<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Att Face — Browser face detection</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <script defer src="face-api.min.js"></script>
  <script defer src="script.js"></script>
</head>
<body>
  <header class="site-header">
    <div class="logo-wrap">
      <img src="assets/logo.svg" alt="Krishna Health Care logo" class="logo">
      <div class="site-title">
        <h1>Krishna Health Care Services</h1>
        <p class="tagline">Caretaker attendance — automated face recognition</p>
      </div>
    </div>
    <div class="brand-actions">
      <div class="header-meta">
        <div class="facility">Matki Chauraha, BJS — Jodhpur</div>
        <div id="current-date" class="current-date"></div>
      </div>
      <div class="header-controls">
        <button id="open-admin-panel" class="btn" title="Open admin panel">Admin</button>
        <span id="status" class="status">Loading models…</span>
      </div>
    </div>
  </header>

  <main class="main">
    <div class="video-panel">
      <div class="video-container">
        <video id="video" width="600" height="450" autoplay muted playsinline></video>
      </div>

      <div class="controls card">
        <p>Allow camera access when prompted. This demo loads labelled faces from <code>./labels</code> and models from <code>/models</code>.</p>
        <ul>
          <li>Sample labels: <strong>moksh</strong>, <strong>shashtika</strong></li>
          <li>Detection runs continuously and draws boxes on the video.</li>
        </ul>

        <div class="control-actions">
          <button id="start-att-btn" class="btn btn-primary" disabled>Start Attendance</button>
          <button id="stop-att-btn" class="btn" disabled>End Attendance</button>
        </div>
        <div class="session-actions" style="margin-top:12px;display:flex;flex-direction:column;gap:8px">
          <label for="session-name" style="font-size:0.85rem;color:var(--muted)">Session name (e.g. Morning shift)</label>
          <input id="session-name" class="session-input" placeholder="Session name (optional)" />
          <div style="display:flex;gap:8px">
            <input id="manual-name-input" class="session-input" placeholder="Add name manually" />
            <button id="manual-add-btn" class="btn">Add</button>
            <button id="clear-session-btn" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.06)">Clear Session</button>
          </div>
        </div>

        <!-- Admin panel moved to the Admin drawer -->
      </div>

      <aside class="attendance-log card" aria-live="polite">
        <div class="log-header">
          <h3>Attendance Log</h3>
          <div class="log-meta"><span id="att-count">0</span> present</div>
        </div>
        <ol id="att-list" class="att-list">
          <!-- logged names will appear here -->
        </ol>
        <div class="log-actions">
          <button id="export-att-btn" class="btn btn-secondary" disabled>Export CSV</button>
          <button id="save-session-btn" class="btn btn-primary" style="margin-left:8px">Save Session</button>
        </div>
      </aside>
    </div>
  </main>

  <!-- Admin slide-over panel -->
  <div id="admin-drawer" class="admin-drawer" aria-hidden="true">
    <div class="admin-drawer-header">
      <h3>Admin dashboard</h3>
      <button id="admin-drawer-close" class="btn">Close</button>
    </div>
    <div class="admin-drawer-body">
      <div class="admin-drawer-section card" style="padding:12px">
        <h4 style="margin:0 0 8px 0">Admin sign up / login</h4>
        <div style="display:flex;gap:8px;margin-bottom:8px">
          <input id="admin-name" class="session-input" placeholder="Your name" />
          <input id="admin-location" class="session-input" placeholder="Location" />
        </div>
        <div style="display:flex;gap:8px;margin-bottom:8px">
          <input id="admin-email" class="session-input" placeholder="Email" />
          <input id="admin-password" type="password" class="session-input" placeholder="Password" />
        </div>
        <div style="display:flex;gap:8px">
          <button id="admin-signup-btn" class="btn">Sign up</button>
          <button id="admin-login-btn" class="btn btn-primary">Login</button>
          <button id="admin-logout-btn" class="btn" style="margin-left:auto;display:none">Logout</button>
        </div>
        <div id="admin-status" style="color:var(--muted);font-size:0.9rem;margin-top:8px">Not logged in</div>
      </div>

      <div class="admin-drawer-section card" style="padding:12px">
        <h4 style="margin:0 0 8px 0">Add Caretaker</h4>
        <div style="display:flex;gap:8px;margin-bottom:8px">
          <input id="new-caretaker-name" class="session-input" placeholder="Caretaker name" />
          <input id="new-caretaker-avatar" class="session-input" placeholder="Avatar URL (optional)" />
          <button id="add-caretaker-btn" class="btn btn-primary">Add Caretaker</button>
        </div>
      </div>
      <div class="admin-drawer-section">
        <div class="admin-drawer-actions">
          <button id="roster-refresh-btn" class="btn">Refresh roster</button>
          <button id="roster-export-btn" class="btn">Export roster</button>
        </div>
        <div class="admin-drawer-status">Status: <span id="drawer-admin-status">Not logged in</span></div>
      </div>

      <div class="admin-drawer-section">
        <h4>Roster</h4>
        <ul id="roster-list" class="roster-list">
          <!-- roster items populated by JS -->
        </ul>
      </div>
      <div style="flex:1"></div>
    </div>
  </div>
  <div id="admin-drawer-backdrop" class="admin-drawer-backdrop" hidden></div>

  <!-- Admin auth modal (professional-looking) -->
  <div id="admin-modal" class="admin-modal" aria-hidden="true">
    <div class="admin-modal-card">
      <button id="admin-modal-close" class="btn modal-close">×</button>
      <div class="auth-grid">
        <div class="auth-illustration" role="img" aria-label="Login illustration"></div>
        <div class="auth-forms">
          <div class="admin-modal-header">
            <h2 id="admin-modal-title">Welcome back</h2>
            <p class="auth-sub">Sign in to manage caretakers and sessions</p>
          </div>
          <div class="admin-modal-tabs">
            <button id="tab-login" class="tab-btn active">Login</button>
            <button id="tab-signup" class="tab-btn">Sign up</button>
          </div>
          <div class="admin-modal-body">
            <form id="auth-login-form" class="auth-form">
              <label>Email
                <input id="modal-login-email" class="session-input" type="email" placeholder="you@company.com" autocomplete="username" />
              </label>
              <label>Password
                <input id="modal-login-password" class="session-input" type="password" placeholder="••••••••" autocomplete="current-password" />
              </label>
              <div class="remember-row">
                <label class="remember-label">
                  <input id="modal-login-remember" type="checkbox" /> Remember me
                </label>
                <a href="#" id="modal-forgot-link" class="forgot-link">Forgot?</a>
              </div>
              <div class="auth-actions">
                <button id="modal-login-btn" type="button" class="btn btn-primary">Login</button>
                <button id="modal-open-dashboard" type="button" class="btn" style="margin-left:auto;display:none">Open dashboard</button>
              </div>
            </form>

            <form id="auth-signup-form" class="auth-form" hidden>
              <label>Name
                <input id="modal-signup-name" class="session-input" type="text" placeholder="Full name" autocomplete="name" />
              </label>
              <label>Location
                <input id="modal-signup-location" class="session-input" type="text" placeholder="Location" />
              </label>
              <label>Email
                <input id="modal-signup-email" class="session-input" type="email" placeholder="you@company.com" autocomplete="email" />
              </label>
              <label>Password
                <input id="modal-signup-password" class="session-input" type="password" placeholder="Create a password" autocomplete="new-password" />
              </label>
              <label>Confirm password
                <input id="modal-signup-password-confirm" class="session-input" type="password" placeholder="Repeat password" autocomplete="new-password" />
              </label>
              <div class="auth-actions">
                <button id="modal-signup-btn" type="button" class="btn btn-primary">Sign up</button>
              </div>
            </form>

            <div id="modal-auth-status" class="modal-status">Not signed in</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="admin-modal-backdrop" class="admin-drawer-backdrop" hidden></div>

  <footer class="site-footer">
    <small>Made with <strong>face-api.js</strong> • Models served from <code>/models</code></small>
  </footer>
</body>
</html>